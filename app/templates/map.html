<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>맛집 지도</title>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}&callback=initMap&libraries=places"></script>
  <style>
    #map { width: 100%; height: 400px; }
    #search-container { margin: 10px 0; }
    #results { list-style: none; padding: 0; margin: 5px 0; }
    #results li { cursor: pointer; padding: 4px; }
    #results li:hover { background: #eee; }
  </style>
</head>
<body>
  <div id="search-container">
    <input id="search-input" type="text" placeholder="장소 검색" />
    <button id="search-btn">검색</button>
    <ul id="results"></ul>
  </div>
  <div id="map"></div>
  <script>
    let map;
    let marker;
    let service;

    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 37.5665, lng: 126.9780},
        zoom: 14
      });
      service = new google.maps.places.PlacesService(map);
      document.getElementById('search-btn').addEventListener('click', () => {
        searchPlaces((document.getElementById('search-input').value || '').trim());
      });
    }

    function searchPlaces(query) {
      if (!query) return;
      service.textSearch({query}, (results, status) => {
        const list = document.getElementById('results');
        list.innerHTML = '';
        if (status !== google.maps.places.PlacesServiceStatus.OK) return;
        results.forEach((place) => {
          const li = document.createElement('li');
          li.textContent = place.name;
          li.addEventListener('click', () => showPlace(place));
          list.appendChild(li);
        });
      });
    }

    function showPlace(place) {
      if (!place.geometry || !place.geometry.location) return;
      if (marker) marker.setMap(null);
      marker = new google.maps.Marker({ map, position: place.geometry.location });
      map.setCenter(place.geometry.location);
      map.setZoom(15);
    }
  </script>
</body>
</html>
